<div class="max-w-7xl mx-auto">
  
  <!-- Main Title -->
  <h2 class="text-3xl font-extrabold text-gray-800 mb-2">
    <i class="fas fa-link text-teal-600 mr-2"></i> Collection Relationships
  </h2>
  <p class="text-gray-500 mb-8 border-b pb-4">
    Manage collection relationships and define data connections between your collections.
  </p>

  <!-- Two Column Layout for the content sections -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    
    <!-- LEFT COLUMN: Select Collections / Used Collections -->
    <div class="lg:col-span-1 bg-white rounded-xl shadow-lg border border-gray-100 divide-y divide-gray-100">
      
      <!-- Select Collections Section -->
      <div class="p-6">
        <h3 class="text-xl font-bold text-gray-800 mb-5 border-b pb-3">
          <i class="fas fa-database text-teal-600 mr-2"></i> Select Collections
        </h3>
        
        <!-- Collection Dropdown -->
        <div class="w-full mb-4">
          <div class="relative">
            <button 
              type="button" 
              (click)="toggleCollectionDropdown(); $event.stopPropagation()"
              class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg shadow-sm focus:border-teal-500 focus:ring-1 focus:ring-teal-500 transition duration-150 text-gray-700 text-left flex justify-between items-center"
            >
              <span class="truncate">
                {{ selectedFields.length > 0 ? selectedFields.length + ' collection(s) selected' : '-- Select Collection --' }}
              </span>
              <i class="fas fa-chevron-down transition-transform duration-200" [class.rotate-180]="isCollectionDropdownOpen"></i>
            </button>
            
            <!-- Dropdown Menu -->
            <div 
              *ngIf="isCollectionDropdownOpen" 
              class="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto"
            >
              <div class="p-2">
                <div *ngFor="let visibleField of visibleFieldList" 
                     class="flex items-center p-2 hover:bg-teal-50 rounded-md cursor-pointer transition-colors duration-150"
                     (click)="toggleCollectionSelection(visibleField)">
                  <input 
                    type="checkbox" 
                    [checked]="selectedFields.includes(visibleField)"
                    class="mr-3 h-4 w-4 text-teal-600 focus:ring-teal-500 border-gray-300 rounded"
                    (click)="$event.stopPropagation()"
                  >
                  <span class="text-sm text-gray-700">{{ visibleField }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Submit Button (Teal Primary Style) -->
        <button 
          (click)="submitCollections()" 
          class="w-full px-5 py-2 bg-teal-600 text-white font-semibold rounded-lg shadow-md shadow-teal-700/30 hover:bg-teal-500 transition duration-200 transform hover:scale-[1.01] active:scale-[0.99]"
        >
          <i class="fas fa-check mr-2"></i> Submit Collections
        </button>
      </div>
      
      <!-- Used Collections List -->
      <div class="p-6">
        <h3 class="text-lg font-bold text-gray-700 mb-4 border-b pb-2">
          <i class="fas fa-list text-teal-600 mr-2"></i> Used Collections
        </h3>
        
        <!-- Header Row -->
        <div class="flex justify-between items-center p-3 text-sm font-semibold text-gray-500 border-b border-gray-200 bg-gray-50 rounded-t-lg">
          <span class="w-full">Collection Name</span>
        </div>
        
        <!-- Collection Items -->
        <div class="space-y-0">
          <div *ngFor="let item of collectionNames" 
               class="flex justify-between items-center p-3 hover:bg-teal-50 transition duration-150 cursor-pointer border-b border-gray-100 last:border-b-0"
               [class.bg-teal-50]="item === selectedSourceCollection"
               [class.border-teal-200]="item === selectedSourceCollection"
               [class.border]="item === selectedSourceCollection">
            <div class="flex items-center space-x-3 w-full">
              <i class="fas fa-database text-teal-600"></i>
              <span class="text-sm font-medium text-gray-800">{{ item }}</span>
            </div>
          </div>
        </div>
        
        <!-- Empty State -->
        <div *ngIf="collectionNames.length === 0" class="p-6 text-center">
          <i class="fas fa-database text-4xl text-gray-300 mb-4"></i>
          <h3 class="text-lg font-medium text-gray-500 mb-2">No collections found</h3>
          <p class="text-gray-400">Select collections to get started</p>
        </div>
      </div>
    </div>

    <!-- RIGHT COLUMN: Create Collection Relationships -->
    <div class="lg:col-span-2 bg-white rounded-xl shadow-lg border border-gray-100">
      <div class="p-6">
        <h3 class="text-xl font-bold text-gray-800 mb-6 border-b pb-3">
          <i class="fas fa-plus-circle text-teal-600 mr-2"></i> Create Collection Relationships
        </h3>
        
        <!-- Relationship Form Grid -->
        <div class="grid grid-cols-2 gap-6">
          <!-- Source Collection -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-arrow-right text-teal-600 mr-1"></i> Source Collection
            </label>
            <div class="relative">
              <button 
                type="button" 
                (click)="toggleSourceCollectionDropdown(); $event.stopPropagation()"
                class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg shadow-sm focus:border-teal-500 focus:ring-1 focus:ring-teal-500 transition duration-150 text-gray-700 text-left flex justify-between items-center"
              >
                <span class="truncate">
                  {{ selectedSourceCollection || '-- Select Source Collection --' }}
                </span>
                <i class="fas fa-chevron-down transition-transform duration-200" [class.rotate-180]="isSourceCollectionDropdownOpen"></i>
              </button>
              
              <!-- Dropdown Menu -->
              <div 
                *ngIf="isSourceCollectionDropdownOpen" 
                class="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto"
              >
                <div class="p-2">
                  <div class="p-2 hover:bg-teal-50 rounded-md cursor-pointer transition-colors duration-150"
                       (click)="selectSourceCollection('')">
                    <span class="text-sm text-gray-500">-- Select Source Collection --</span>
                  </div>
                  <div *ngFor="let name of collectionNames" 
                       class="p-2 hover:bg-teal-50 rounded-md cursor-pointer transition-colors duration-150"
                       (click)="selectSourceCollection(name)">
                    <span class="text-sm text-gray-700">{{ name }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Source Field -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-tag text-teal-600 mr-1"></i> Source Field
            </label>
            <div class="relative">
              <button 
                type="button" 
                (click)="toggleSourceFieldDropdown(); $event.stopPropagation()"
                class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg shadow-sm focus:border-teal-500 focus:ring-1 focus:ring-teal-500 transition duration-150 text-gray-700 text-left flex justify-between items-center"
                [disabled]="!selectedSourceCollection"
              >
                <span class="truncate">
                  {{ selectedSourceField || '-- Select Source Field --' }}
                </span>
                <i class="fas fa-chevron-down transition-transform duration-200" [class.rotate-180]="isSourceFieldDropdownOpen"></i>
              </button>
              
              <!-- Dropdown Menu -->
              <div 
                *ngIf="isSourceFieldDropdownOpen" 
                class="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto"
              >
                <div class="p-2">
                  <div class="p-2 hover:bg-teal-50 rounded-md cursor-pointer transition-colors duration-150"
                       (click)="selectSourceField('')">
                    <span class="text-sm text-gray-500">-- Select Source Field --</span>
                  </div>
                  <div *ngFor="let field of sourceFields" 
                       class="p-2 hover:bg-teal-50 rounded-md cursor-pointer transition-colors duration-150"
                       (click)="selectSourceField(field)">
                    <span class="text-sm text-gray-700">{{ field }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Target Collection -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-arrow-left text-teal-600 mr-1"></i> Target Collection
            </label>
            <div class="relative">
              <button 
                type="button" 
                (click)="toggleTargetCollectionDropdown(); $event.stopPropagation()"
                class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg shadow-sm focus:border-teal-500 focus:ring-1 focus:ring-teal-500 transition duration-150 text-gray-700 text-left flex justify-between items-center"
              >
                <span class="truncate">
                  {{ selectedTargetCollection || '-- Select Target Collection --' }}
                </span>
                <i class="fas fa-chevron-down transition-transform duration-200" [class.rotate-180]="isTargetCollectionDropdownOpen"></i>
              </button>
              
              <!-- Dropdown Menu -->
              <div 
                *ngIf="isTargetCollectionDropdownOpen" 
                class="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto"
              >
                <div class="p-2">
                  <div class="p-2 hover:bg-teal-50 rounded-md cursor-pointer transition-colors duration-150"
                       (click)="selectTargetCollection('')">
                    <span class="text-sm text-gray-500">-- Select Target Collection --</span>
                  </div>
                  <div *ngFor="let name of collectionNames" 
                       class="p-2 hover:bg-teal-50 rounded-md cursor-pointer transition-colors duration-150"
                       (click)="selectTargetCollection(name)">
                    <span class="text-sm text-gray-700">{{ name }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Target Field -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-tag text-teal-600 mr-1"></i> Target Field
            </label>
            <div class="relative">
              <button 
                type="button" 
                (click)="toggleTargetFieldDropdown(); $event.stopPropagation()"
                class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg shadow-sm focus:border-teal-500 focus:ring-1 focus:ring-teal-500 transition duration-150 text-gray-700 text-left flex justify-between items-center"
                [disabled]="!selectedTargetCollection"
              >
                <span class="truncate">
                  {{ selectedTargetField || '-- Select Target Field --' }}
                </span>
                <i class="fas fa-chevron-down transition-transform duration-200" [class.rotate-180]="isTargetFieldDropdownOpen"></i>
              </button>
              
              <!-- Dropdown Menu -->
              <div 
                *ngIf="isTargetFieldDropdownOpen" 
                class="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto"
              >
                <div class="p-2">
                  <div class="p-2 hover:bg-teal-50 rounded-md cursor-pointer transition-colors duration-150"
                       (click)="selectTargetField('')">
                    <span class="text-sm text-gray-500">-- Select Target Field --</span>
                  </div>
                  <div *ngFor="let field of targetFields" 
                       class="p-2 hover:bg-teal-50 rounded-md cursor-pointer transition-colors duration-150"
                       (click)="selectTargetField(field)">
                    <span class="text-sm text-gray-700">{{ field }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Add Relationship Button (Teal Primary Style) -->
        <div class="flex justify-end mt-8">
          <button 
            (click)="addRelationship()"
            [disabled]="!selectedSourceCollection || !selectedTargetCollection || !selectedSourceField || !selectedTargetField"
            class="px-6 py-2 bg-teal-600 text-white font-semibold rounded-lg shadow-md shadow-teal-700/30 hover:bg-teal-500 transition duration-200 transform hover:scale-[1.01] active:scale-[0.99] disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <i class="fas fa-link mr-2"></i> Add Relationship
          </button>
        </div>
      </div>

      <!-- Relationships Table -->
      <div *ngIf="relationships.length > 0" class="border-t border-gray-100">
        <div class="p-6">
          <h3 class="text-lg font-bold text-gray-700 mb-4 border-b pb-2">
            <i class="fas fa-list text-teal-600 mr-2"></i> Defined Relationships
          </h3>
          
          <!-- Table Container -->
          <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Source Collection</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Source Field</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Target Collection</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Target Field</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  <tr *ngFor="let rel of relationships; let i = index" class="hover:bg-gray-50 transition duration-150">
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">
                      <div class="flex items-center space-x-2">
                        <i class="fas fa-database text-teal-600"></i>
                        <span>{{ rel.collectionA }}</span>
                      </div>
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">
                      <div class="flex items-center space-x-2">
                        <i class="fas fa-tag text-gray-400"></i>
                        <span>{{ rel.fieldA }}</span>
                      </div>
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">
                      <div class="flex items-center space-x-2">
                        <i class="fas fa-database text-teal-600"></i>
                        <span>{{ rel.collectionB }}</span>
                      </div>
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">
                      <div class="flex items-center space-x-2">
                        <i class="fas fa-tag text-gray-400"></i>
                        <span>{{ rel.fieldB }}</span>
                      </div>
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">
                      <button 
                        (click)="removeRelationship(i, rel._id)"
                        class="p-2 text-gray-400 hover:text-red-500 rounded-full hover:bg-red-50 transition duration-150"
                        title="Remove Relationship"
                      >
                        <i class="fas fa-trash-can"></i>
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Empty State for Relationships -->
      <div *ngIf="relationships.length === 0" class="border-t border-gray-100 p-8 text-center">
        <i class="fas fa-link text-4xl text-gray-300 mb-4"></i>
        <h3 class="text-lg font-medium text-gray-500 mb-2">No relationships defined</h3>
        <p class="text-gray-400">Create your first relationship to connect collections</p>
      </div>
    </div>
  </div>
</div>